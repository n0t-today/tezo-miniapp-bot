# ТЗ: Веб-админка

Отдельный документ с подробным описанием каждой страницы веб-админки.  
Общее ТЗ — в файле `TZ.md`.  
Язык интерфейса: русский. Формат дат: dd.mm.yyyy.

**Хранение изображений товаров:** S3. Загрузка и удаление изображений в админке выполняются через бэкенд; в БД хранятся только URL (или ключи) изображений в S3.

---

## Общая разметка и навигация

- **Шапка:** логотип/название админки, имя пользователя, «Выход».
- **Боковое меню** (или верхняя навигация) с разделами:
  - Главная
  - Розыгрыш
  - Магазин
  - Заказы
  - Обращения
  - Пользователи и роли (или Настройки)
  - Выход
- Доступ к разделам в соответствии с ролями (скрытие пунктов меню при отсутствии прав).
- Контент справа (или под меню): заголовок страницы, хлебные крошки при углублении (например: Магазин → Название товара).

---

## Страница 1. Главная админки

**Путь:** `/` или `/admin`

**Назначение:** сводка и быстрый доступ к разделам.

| Блок | Описание |
|------|----------|
| Виджеты/карточки | Краткая сводка: есть ли активный розыгрыш, количество заказов за период (день/неделя), количество новых/открытых обращений. Цифры кликабельны — переход в соответствующий раздел |
| Кнопки/ссылки | Быстрый переход: «Розыгрыш», «Магазин», «Заказы», «Обращения» |

---

## Страница 2. Розыгрыш — общая

**Путь:** `/admin/raffle`

**Назначение:** состояние текущего розыгрыша, список призов, добавление/редактирование/удаление призов.

### 2.1 Блок состояния розыгрыша (верх страницы)

| Элемент | Описание |
|---------|----------|
| Статус | Текст/бейдж: «Активный» / «Завершён» |
| Прогресс-бар | Подпись: «Спинов до главного выигрыша: N». Визуальный прогресс-бар: от 0 до заданного лимита; текущее значение = (лимит − N). При N = 0 — «Следующий спин — гарантированный выигрыш» |
| Настройка лимита | Поле «Количество спинов до главного выигрыша» (редактируется при создании розыгрыша или в настройках текущего, если разрешено логикой) |
| Действия при завершении | Когда розыгрыш завершён (главный выигрыш выдан): две кнопки — **«Повторить розыгрыш»** (те же призы и настройки, сброс счётчика) и **«Создать новый розыгрыш»** (новая конфигурация призов и лимита) |

### 2.2 Список призов

| Элемент | Описание |
|---------|----------|
| Таблица или карточки | Все призы текущего розыгрыша: превью изображения, название, вероятность (%), кнопки действий |
| Кнопка «Добавить приз» | Переход на страницу/форму добавления приза (аналог карточки приза) |
| Для каждого приза | **«Изменить»** — переход в карточку приза на редактирование; **«Удалить»** — запрос подтверждения «Вы уверены?» с кнопками «Да» / «Нет» |

### 2.3 Карточка приза (страница добавления/редактирования)

**Путь:** `/admin/raffle/prizes/new`, `/admin/raffle/prizes/:id`

| Блок | Описание |
|------|----------|
| Хлебные крошки | Розыгрыш → Добавить приз / Название приза |
| Изображение | Загрузка фото приза. Загрузка в S3 через бэкенд; в форме — превью и возможность заменить/удалить |
| Название | Текстовое поле |
| Размеры | Переключатель «Есть размеры» да/нет. При «да» — список размеров (добавление/удаление вариантов) |
| Цена в бонусах | Число (для отображения в мини-апп; за спин в игре фиксировано 20 бонусов) |
| Вероятность выпадения | Процент (сумма вероятностей по всем призам может учитываться при валидации) |
| Кнопки | **«Сохранить»** — сохранение и возврат к списку призов; **«Отмена»** — возврат без сохранения |

---

## Раздел «Магазин» — структура страниц

Цель: удобное администрирование позиций — порядок в списке, добавление товаров, изменение и удаление, углубление в товар и редактирование в одной карточке товара. Изображения хранятся в S3.

**Схема навигации:**
1. **Каталог (список)** — все товары магазина; фильтры, сортировка; переход в карточку товара или создание нового.
2. **Карточка товара** — одна страница с полной информацией о товаре; все правки делаются здесь (редактирование в карточке). Режимы: просмотр + режим редактирования (или сразу режим редактирования для админа).
3. **Добавление товара** — та же по структуре страница «Карточка товара», но с пустой формой (новый товар); после сохранения — редирект в карточку созданного товара или в каталог.

Итого страниц в разделе «Магазин»:
- Каталог (список товаров)
- Карточка товара (просмотр и редактирование)
- Добавление товара (частный случай карточки с пустой формой)

---

## Страница 3. Магазин — каталог (список товаров)

**Путь:** `/admin/shop`

**Назначение:** обзор всех позиций магазина, быстрый поиск и фильтрация, переход к добавлению или к карточке товара.

### 3.1 Шапка каталога

| Элемент | Описание |
|---------|----------|
| Заголовок | «Магазин» или «Товары» |
| Кнопка «Добавить товар» | Переход на `/admin/shop/new` |

### 3.2 Панель фильтров и сортировки (опционально)

| Элемент | Описание |
|---------|----------|
| Поиск | Поле поиска по названию товара |
| Фильтр | «Участвует в розыгрыше» — да / нет / все |
| Фильтр | «В наличии» — да / нет / все (по остатку) |
| Сортировка | По названию, по дате добавления, по цене (бонусы/рубли) — выпадающий список |

### 3.3 Таблица (или карточная сетка) товаров

Каждая строка (или карточка) содержит:

| Колонка/блок | Описание |
|--------------|----------|
| Превью | Миниатюра основного изображения товара (URL из S3). При отсутствии — плейсхолдер «Нет фото» |
| Название | Название товара. Клик по названию или по строке — переход в карточку товара `/admin/shop/:id` |
| Цена (бонусы) | Цена в бонусах (с учётом скидки при отображении) |
| Цена (рубли) | Цена в рублях (с учётом скидки при отображении) |
| Скидка | Процент скидки (если задан) |
| В розыгрыше | Да / Нет (иконка или текст) |
| Остаток | Количество в наличии или «Нет в наличии» |
| Действия | **«Открыть»** (переход в карточку товара); **«Удалить»** (подтверждение «Вы уверены?» → «Да» / «Нет») |

Удобство: из списка можно только открыть товар или удалить. Все изменения — в карточке товара.

---

## Страница 4. Магазин — карточка товара (просмотр и редактирование)

**Путь:** `/admin/shop/:id`

**Назначение:** полная информация о товаре и всё редактирование в одном месте — углубление в товар и редактирование в карточке.

### 4.1 Шапка карточки

| Элемент | Описание |
|---------|----------|
| Хлебные крошки | Магазин → [Название товара] |
| Заголовок | Название товара (в режиме просмотра) или «Редактирование: [название]» (в режиме редактирования) |
| Режим | По умолчанию — просмотр. Кнопка **«Редактировать»** переключает в режим редактирования (поля становятся редактируемыми). В режиме редактирования — кнопки **«Сохранить»** и **«Отмена»** (отмена возвращает к просмотру без сохранения) |
| Удаление | Кнопка **«Удалить товар»** (в просмотре или в редактировании). По нажатию — модальное окно «Вы уверены?» с кнопками «Да» / «Нет». При «Да» — удаление товара и редирект в каталог `/admin/shop` |

### 4.2 Блок «Изображения» (S3)

| Элемент | Описание |
|---------|----------|
| Основное фото | Одно основное изображение товара. В режиме редактирования: загрузка нового файла (загрузка на S3 через бэкенд), удаление текущего, превью. В БД/настройках хранится URL (или ключ) в S3 |
| Дополнительные фото | Опционально: галерея из нескольких изображений. В режиме редактирования: добавление файлов, удаление, изменение порядка (сортировка). Все файлы загружаются в S3; в БД — массив URL (или ключей) |
| Требования к загрузке | Формат, максимальный размер файла и размер стороны — по внутренним правилам (например, JPG/PNG, до 5 МБ). При ошибке загрузки — сообщение пользователю |

Изображения в мини-приложении отдаются по этим URL (через S3 или через прокси бэкенда).

### 4.3 Блок «Основное»

| Поле | Режим просмотра | Режим редактирования |
|------|-----------------|----------------------|
| Название товара | Текст | Текстовое поле |
| Есть размеры | Да / Нет | Переключатель или чекбокс |
| Размеры | Список размеров | При «есть размеры» — список с возможностью добавить/удалить варианты (например, поля «Размер 1», «Размер 2» + кнопка «Добавить размер») |

### 4.4 Блок «Цены и скидка»

| Поле | Режим просмотра | Режим редактирования |
|------|-----------------|----------------------|
| Цена в бонусах | Число | Числовое поле |
| Цена в рублях | Число | Числовое поле |
| Скидка | Процент (%) | Числовое поле (процент). Применение скидки: к цене в бонусах и к цене в рублях (одинаковый процент к обоим типам цен, если иное не оговорено) |

В мини-приложении отображаются цены уже с учётом скидки.

### 4.5 Блок «Наличие и видимость»

| Поле | Режим просмотра | Режим редактирования |
|------|-----------------|----------------------|
| Участвует в розыгрыше | Да / Нет | Чекбокс «Участвует в розыгрыше» |
| Остаток (наличие) | Количество или «Нет в наличии» | Числовое поле «Остаток» (0 = не показывать в мини-апп или показывать как «Нет в наличии») |

### 4.6 Кнопки внизу карточки (в режиме редактирования)

| Кнопка | Действие |
|--------|----------|
| **Сохранить** | Валидация полей; отправка данных на бэкенд; обновление изображений в S3 при изменении; после успеха — переход в режим просмотра или сообщение «Сохранено» |
| **Отмена** | Выход из режима редактирования без сохранения; возврат к просмотру текущей карточки |

---

## Страница 5. Магазин — добавление товара

**Путь:** `/admin/shop/new`

**Назначение:** создание новой позиции магазина. Структура страницы совпадает с карточкой товара, но все поля пустые; логика — как у карточки редактирования.

| Элемент | Описание |
|---------|----------|
| Хлебные крошки | Магазин → Новый товар |
| Заголовок | «Новый товар» |
| Блоки полей | Те же, что в карточке товара (Изображения, Основное, Цены и скидка, Наличие и видимость). Все поля доступны для ввода |
| Изображения | Загрузка основного и при необходимости дополнительных фото; загрузка в S3 через бэкенд |
| Кнопки | **«Сохранить»** — создание товара, редирект в карточку созданного товара (`/admin/shop/:id`) или в каталог. **«Отмена»** — переход в каталог без сохранения |

Удаление на странице нового товара не показывается (товар ещё не создан).

---

## Страница 6. Заказы

**Путь:** `/admin/orders`

**Назначение:** просмотр заявок и деталей заказов. Заказы дублируются в Telegram-супергруппу.

| Блок | Описание |
|------|----------|
| Заголовок | «Заказы» |
| Фильтры | По периоду (дата от — до), по статусу (новый, в работе, выполнен и т.д.) — перечень статусов уточняется |
| Таблица | Список заказов: дата (dd.mm.yyyy), идентификатор/номер заказа, пользователь (Telegram, имя или ID), сумма (бонусы + рубли), статус, способ доставки. Клик по строке — открытие деталей заказа |
| Детали заказа | В отдельной панели/странице/модальном окне: состав заказа (позиции, количество, цены), адрес доставки, способ доставки, способ оплаты (бонусы, рубли, промокод), ссылка/ID темы в супергруппе (при наличии) |

---

## Страница 7. Обращения

**Путь:** `/admin/appeals`

**Назначение:** тикеты пользователей и ответы. Обращения дублируются в супергруппу (одно обращение = одна тема); двусторонняя связь.

| Блок | Описание |
|------|----------|
| Заголовок | «Обращения» |
| Фильтры | По категории, по статусу, по дате |
| Список тикетов | Таблица или список: категория, дата (dd.mm.yyyy), автор (пользователь), краткий текст (первые строки), статус. Клик — открытие тикета |
| Открытый тикет | Переписка: сообщения пользователя и ответы менеджера в хронологическом порядке. Поле ввода ответа и кнопка «Отправить». При отправке ответ уходит в бот пользователю и в тему супергруппы |

---

## Страница 8. Пользователи и роли

**Путь:** `/admin/users`, `/admin/roles` (или общая страница `/admin/settings` с вкладками)

**Назначение:** управление админами бота (Telegram) и ролями веб-админки.

### 8.1 Админы бота (Telegram)

| Элемент | Описание |
|---------|----------|
| Список | Telegram ID текущих админов бота |
| Добавление | Способ добавления админа (метод с референса): например, ввод Telegram ID и сохранение, или выдача ссылки-приглашения |
| Удаление | Для каждого админа — кнопка «Удалить» (с подтверждением). ID 7533811917 предусмотрен по умолчанию в конфиге; в админке можно добавлять и удалять дополнительных админов |

### 8.2 Роли веб-админки

| Элемент | Описание |
|---------|----------|
| Список ролей | Название роли, количество пользователей с этой ролью (при наличии привязки пользователей к ролям) |
| Создание/редактирование роли | Название роли; права доступа по разделам: Розыгрыш (просмотр/редактирование), Магазин (просмотр/редактирование), Заказы (просмотр), Обращения (просмотр/ответ), Пользователи и роли (просмотр/редактирование). Чекбоксы или матрица прав |
| Удаление роли | С подтверждением; учёт привязки пользователей к роли |

---

## S3 — сводка требований

| Аспект | Описание |
|--------|----------|
| Назначение | Хранение изображений товаров (основное фото и галерея) для магазина и розыгрыша |
| Загрузка | Из веб-админки: выбор файла → отправка на бэкенд → загрузка бэкендом в S3; возврат URL (или ключа) для сохранения в БД |
| Удаление | В карточке товара/приза — удаление изображения; запрос к бэкенду → удаление объекта в S3 и обновление данных в БД |
| Отдача в мини-приложение | Мини-приложение получает URL изображений из API; отображение по URL (напрямую S3 или через CDN/прокси) |
| Права доступа | Bucket/объекты S3 настроены так, чтобы загрузка и удаление выполнялись только через бэкенд с авторизацией; при необходимости — публичное чтение по URL для отображения в мини-апп |

---

## Итоговая схема страниц веб-админки

| № | Раздел | Путь | Кратко |
|---|--------|------|--------|
| 1 | Главная | `/admin` | Сводка, быстрые ссылки |
| 2 | Розыгрыш | `/admin/raffle` | Состояние, прогресс-бар, список призов, добавление/редактирование/удаление приза |
| 3 | Магазин — каталог | `/admin/shop` | Список товаров, фильтры, «Добавить товар», переход в карточку |
| 4 | Магазин — карточка | `/admin/shop/:id` | Просмотр и редактирование в одной карточке; изображения S3 |
| 5 | Магазин — новый товар | `/admin/shop/new` | Та же структура, что карточка; пустая форма |
| 6 | Заказы | `/admin/orders` | Список, фильтры, детали заказа |
| 7 | Обращения | `/admin/appeals` | Список тикетов, переписка, ответ |
| 8 | Пользователи и роли | `/admin/users`, `/admin/roles` | Админы бота, роли и права |
